var idx=window.location.href.lastIndexOf("/"),baseUrl=window.location.href.slice(0,idx+1);require.config({baseUrl:baseUrl,paths:{echarts:"../libraries/echarts/build/dist"}}),require(["echarts","echarts/chart/scatter"],function(a){var b=require("echarts/config"),c=a.init(document.getElementById("main"));option={title:{text:"LINCS Milestones Overview",subtext:"An interactive plot",padding:0},tooltip:{trigger:"axis",showDelay:0,axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}}},toolbox:{show:!0,feature:{mark:{show:!0,title:{mark:"enable/disablemarkline",markUndo:"undo mark line",markClear:"clear mark line"}},dataZoom:{show:!0,title:{dataZoom:"zoom in selected region",dataZoomReset:"zoom out"}},restore:{show:!0,title:"restore"},saveAsImage:{show:!0,title:"save as image"}}},xAxis:[{type:"value",scale:!0,name:"perturbation"}],yAxis:[{type:"value",scale:!0,name:"cell"}]},$.getJSON("data/chartInput",function(a){option.tooltip.formatter=function(b){return a.tooltip[b.value[0]][b.value[1]].centerAssays+" <br/>"+a.perts[b.value[0]-1].pert+", "+a.cells[b.value[1]-1].cell},option.xAxis[0].axisLabel={formatter:function(b){return b>a.perts.length||0>=b?"":a.perts[b-1].pert},interval:function(a){return!0}},option.yAxis[0].axisLabel={formatter:function(b){return b>a.cells.length||0>=b?"":a.cells[b-1].cell},interval:0};var d={"Broad-LINCS-Transcriptomics":"#e377c2","Broad-LINCS-PCCSE":"#bcbd22","HMS-LINCS":"#17becf",DTOXS:"#e7969c","MEP-LINCS":"#ff7f0e",NeuroLINCS:"#2ca02c"},e={image:"emptyRectangle",transcriptomic:"emptyTriangle",proteomic:"emptyCircle",phenotypic:"emptyDiamond"};option.color=[],option.symbolList=[],a.centerAssays.forEach(function(a){option.color.push(d[a[0]]),option.symbolList.push(e[a[1]])}),option.series=[],a.centerAssays.forEach(function(b,c){var d={};d.name=b[0]+" ,"+b[1],d.type="scatter",d.data=a.serieses[c],"proteomic"==b[1]&&(d.symbolSize=5.5),"image"==b[1]&&(d.symbolSize=5.5),option.series.push(d)}),pertClassCount={},currentClass=a.perts[0].pertClass,count=0,a.perts.forEach(function(a,b){a.pertClass==currentClass?count+=1:(pertClassCount[currentClass]={},pertClassCount[currentClass].count=count,pertClassCount[currentClass].x=b,count=1,currentClass=a.pertClass)}),option.series.push({name:"external perturbations end here",type:"scatter",data:[[]],markLine:{data:[[{name:"",value:pertClassCount.external.count,xAxis:pertClassCount.external.x+.5,yAxis:-10},{name:"",xAxis:pertClassCount.external.x+.5,yAxis:58}]]}}),option.series.push({name:"genetic perturbations end here",type:"scatter",data:[[]],markLine:{data:[[{name:"",value:pertClassCount.genetic.count,xAxis:pertClassCount.genetic.x+.5,yAxis:-10},{name:"",xAxis:pertClassCount.genetic.x+.5,yAxis:58}]]}}),option.series.push({name:"microenvironment perturbations end here",type:"scatter",data:[[]],markLine:{data:[[{name:"",value:pertClassCount.microenvironment.count,xAxis:pertClassCount.microenvironment.x+.5,yAxis:-10},{name:"",xAxis:pertClassCount.microenvironment.x+.5,yAxis:58}]]}}),c.setOption(option);var f=_.template("<div class='pert-cell'><%= pert %>, <%= cell %></div>"),g=_.template("<div class='milestone'><div class='center'><%= center %></div><div class='assay'><%= assay %></div><div class='assay-info'><%= assayInfo %></div></div>"),h=window.location.href.lastIndexOf("/"),i=window.location.href.slice(0,h+1);c.on(b.EVENT.CLICK,function(b,c){var d=a.perts[b.data[0]-1].pert,e=a.cells[b.data[1]-1].cell,h=a.tooltip[b.data[0]][b.data[1]].ids;$("#dynamic").children().remove(),$("#dynamic").append(f({pert:d,cell:e})),$.get(i+"meta?ids="+JSON.stringify(h),function(a){a.forEach(function(a){var b={};a.assay.length>a["assay-info"].length&&"ISMMS-Iyengar"!=a.center?(b.assay=a["assay-info"],b.assayInfo=a.assay):(b.assay=a.assay,b.assayInfo=a["assay-info"]),b.center=a.center,$("#dynamic").append(g(b))})}),$("#dView").css("display","block")}),$("#dView").draggable(),$("#close").click(function(){$("#dView").css("display","none"),$("#dynamic").children().remove()})})}),$(".header").click(function(){$header=$(this),$content=$header.next(),$content.slideToggle(500,function(){$header.text(function(){return $content.is(":visible"),"Entires not included"})})});